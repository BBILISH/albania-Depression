import React, { useState, useEffect, useRef } from 'react';
import { PieChart, Pie, Cell, ResponsiveContainer, Legend, Tooltip } from 'recharts';

// Helper function to convert miles to kilometers
const milesToKm = (miles) => (miles * 1.60934).toFixed(1);

// Helper functions for localStorage
const loadFromLocalStorage = (key, defaultValue) => {
  try {
    const serializedState = localStorage.getItem(key);
    if (serializedState === null) {
      return defaultValue;
    }
    return JSON.parse(serializedState);
  } catch (error) {
    console.error("Error loading from localStorage:", error);
    return defaultValue;
  }
};

const saveToLocalStorage = (key, state) => {
  try {
    const serializedState = JSON.stringify(state);
    localStorage.setItem(key, serializedState);
  } catch (error) {
    console.error("Error saving to localStorage:", error);
  }
};

// Data for the trip - extracted from the PDF
const tripData = {
  title: "××œ×‘× ×™×” ×“×¤×¨×¡×™×”",
  dates: "28 ×‘××•×’×•×¡×˜ - 7 ×‘×¡×¤×˜××‘×¨",
  flights: [
    {
      id: "flight1",
      type: "×˜×™×¡×”",
      route: "×ª×œ ××‘×™×‘-×™×¤×• (TLV) â†’ ×˜×™×¨× ×” (TIA)",
      date: "×™×•× ×—××™×©×™, 28 ×‘××•×’×•×¡×˜",
      time: "13:00 - 14:55",
      airline: "EL AL LY 5483",
      cost: 683.00,
      currency: "ILS"
    },
    {
      id: "flight2",
      type: "×˜×™×¡×”",
      route: "×˜×™×¨× ×” (TIA) â†’ ×ª×œ ××‘×™×‘-×™×¤×• (TLV)",
      date: "×™×•× ×¨××©×•×Ÿ, 7 ×‘×¡×¤×˜××‘×¨",
      time: "15:35 - 19:10",
      airline: "EL AL LY 5484",
      cost: 683.00,
      currency: "ILS"
    }
  ],
  lodging: [
    {
      id: "lodging1",
      name: "Rruga Edith Durham 25",
      address: "Rruga Edith Durham 25, ShkodÃ«r 4001, Albania",
      dates: "28-29 ×‘××•×’×•×¡×˜",
      confirmation: "HM8TMAKB43",
      contact: "https://wa.me/355694552255",
      cost: 136.00,
      currency: "ILS",
      type: "×“×™×¨×”"
    },
    {
      id: "lodging2",
      name: "North Alpine Villas",
      address: "9MXH+63, BogÃ«, Albania",
      dates: "29-31 ×‘××•×’×•×¡×˜",
      confirmation: "HMR3XMBREA",
      contact: "https://wa.me/355699955869",
      cost: 1179.00,
      currency: "ILS",
      type: "×•×™×œ×”"
    },
    {
      id: "lodging3",
      name: "8F6M+3CC",
      address: "8F6M-3CC, Rruga Pavaresia 2002, DurrÃ«s 2002, Albania",
      dates: "31 ×‘××•×’×•×¡×˜ - 1 ×‘×¡×¤×˜××‘×¨",
      confirmation: "HMMFKKD2ZH",
      contact: "https://wa.me/355696865066",
      cost: 125.00,
      currency: "ILS",
      type: "×“×™×¨×”"
    },
    {
      id: "lodging4",
      name: "Hakuna Matata Residence & Apartments",
      address: "KALAJA, Rr. Aleksander Moisiu, vis-a-vis plazhit, VlorÃ« 9405, Albania",
      dates: "1-7 ×‘×¡×¤×˜××‘×¨",
      confirmation: "HM48PSE5EQ",
      contact: "https://wa.me/355694884466",
      cost: 1966.00,
      currency: "ILS",
      type: "×“×™×¨×”"
    }
  ],
  carRental: {
    id: "carRental1",
    name: "Rent a Car in Tirana - VT Rentals",
    pickup: {
      date: "×™×•× ×—××™×©×™, 28 ×‘××•×’×•×¡×˜",
      time: "15:15",
      location: "Pallatet Agimi, Rruga Vaso Pasha, TiranÃ« 1001, Albania",
    },
    dropoff: {
      date: "×™×•× ×¨××©×•×Ÿ, 7 ×‘×¡×¤×˜××‘×¨",
      time: "13:00",
      location: "Pallatet Agimi, Rruga Vaso Pasha, TiranÃ« 1001, Albania",
    },
    cost: 310.00,
    currency: "EUR"
  },
  itinerary: [
    {
      date: "×™×•× ×—××™×©×™, 28 ×‘××•×’×•×¡×˜",
      hebrewDate: "×™×•× ×—××™×©×™",
      description: "×™×•× ×‘×˜×™×¨×× ×”, ×¢×¨×‘ ×‘×©×§×•×“×¨×”",
      activities: [
        { type: "mandatory", text: "×˜×™×¡×” ××ª×œ ××‘×™×‘-×™×¤×• ×œ×˜×™×¨× ×” (EL AL LY 5483)", time: "13:00 - 14:55", notes: "" },
        { type: "mandatory", text: "××™×¡×•×£ ×¨×›×‘ ×©×›×•×¨ ×‘×˜×™×¨× ×” (VT Rentals)", time: "15:15", notes: "" },
        { type: "mandatory", text: `× ×¡×™×¢×” ×œ×©×§×•×“×¨×” (${milesToKm(61.3)} ×§"×, ×›-1 ×©' 49 ×“×§')`, notes: "" },
        { type: "mandatory", text: "×¦'×§-××™×Ÿ ×‘×“×™×¨×” ×‘-Rruga Edith Durham 25, ×©×§×•×“×¨×”", notes: "" },
      ],
      lodgingId: "lodging1"
    },
    {
      date: "×™×•× ×©×™×©×™, 29 ×‘××•×’×•×¡×˜",
      hebrewDate: "×™×•× ×©×™×©×™",
      description: "×”×œ×™×›×” + ××•××’×”",
      activities: [
        { type: "mandatory", text: "×¦'×§-×××•×˜ ××”×“×™×¨×” ×‘-Rruga Edith Durham 25", notes: "" },
        { type: "mandatory", text: `× ×¡×™×¢×” ×œ-North Alpine Villas, ×‘×•×’×” (${milesToKm(29.2)} ×§"×, ×›-1 ×©' 23 ×“×§')`, notes: "" },
        { type: "mandatory", text: "×¦'×§-×™×Ÿ ×‘-North Alpine Villas", notes: "" },
        { type: "mandatory", text: `Camping_Private Kabine(room) NORTH ALBANIA (×›-${milesToKm(15.7)} ×§"×, 48 ×“×§') - ×œ×©×™× ××ª ×”××•×›×œ ×‘××§×¨×¨`, notes: "" },
        { type: "mandatory", text: `××•××’×” Thethi Zipline (×›-${milesToKm(1.8)} ×§"×, 12 ×“×§')`, link: "https://www.google.com/maps/search/?api=1&query=Thethi+Zipline", notes: "××•××’×” ××˜×•×¨×¤×ª ××¢×œ ×§× ×™×•×Ÿ!" },
        { type: "mandatory", text: `××¡×œ×•×œ Thet Thet Khaing (×›-${milesToKm(10.7)} ×§"×, 39 ×“×§') - <a href="https://www.wikiloc.com/hiking-trails/valle-de-theth-okol-y-ki-shtrazes-desde-theth-78816286/photo-51245713" target="_blank" rel="noopener noreferrer">×¤×¨×˜×™× × ×•×¡×¤×™×</a>`, notes: "××¡×œ×•×œ ×”×œ×™×›×” ×™×¤×”×¤×” ×‘×˜×‘×¢." },
        { type: "mandatory", text: `Buni i Bajraktarit (×›-${milesToKm(5.4)} ×§"×, 17 ×“×§') - × ×•×£ ×××© ×™×¤×” ×•×‘×“×¨×š ×©×œ× ×•`, link: "https://www.google.com/maps/search/?api=1&query=Buni+i+Bajraktarit", notes: "× ×§×•×“×ª ×ª×¦×¤×™×ª ××¨×”×™×‘×”." },
        { type: "mandatory", text: "×—×–×¨×” ×œ-North Alpine Villas", notes: "" },
        { type: "mandatory", text: "×›× ×™×¡×ª ×©×‘×ª ×‘-18:50", notes: "" }
      ],
      lodgingId: "lodging2"
    },
    {
      date: "×™×•× ×©×‘×ª, 30 ×‘××•×’×•×¡×˜",
      hebrewDate: "×™×•× ×©×‘×ª",
      description: "×©×‘×ª ×‘××–×•×¨ ×ª'×ª",
      activities: [
        { type: "mandatory", text: "×©×”×™×™×” ×‘×“×™×¨×” ×‘-North Alpine Villas", notes: "" }
      ],
      lodgingId: "lodging2"
    },
    {
      date: "×™×•× ×¨××©×•×Ÿ, 31 ×‘××•×’×•×¡×˜",
      hebrewDate: "×™×•× ×¨××©×•×Ÿ",
      description: "××’×, ×¨×›×‘×œ, ×–×™×¤×œ×™×™×Ÿ",
      activities: [
        { type: "mandatory", text: "×¦'×§-×××•×˜ ×-North Alpine Villas", notes: "" },
        { type: "mandatory", text: `× ×¡×™×¢×” ×œ×“×™×¨×” ×‘-8F6M+3CC, ×“×•×¨×¡ (×›-${milesToKm(155)} ×§"×, 5 ×©' 36 ×“×§')`, notes: "" },
        { type: "mandatory", text: `××’× ×‘×•×‘×™×œ×” (×›-${milesToKm(99.7)} ×§"× ×-North Alpine Villas, 3 ×©' 43 ×“×§') - <a href="https://www.wikiloc.com/hiking-trails/lake-bovilla-gamti-mountain-lake-bovilla-34432538" target="_blank" rel="noopener noreferrer">×¤×¨×˜×™× × ×•×¡×¤×™×</a>`, notes: "××’× ×™×¤×”×¤×” ×¢× ××¤×©×¨×•×ª ×œ×˜×™×•×œ ×¨×’×œ×™." },
        { type: "mandatory", text: `×¨×›×‘×œ ×“××™×˜×™ ××§×¡×¤×¨×¡ (×›-${milesToKm(11)} ×§"× ×××’× ×‘×•×‘×™×œ×”, 39 ×“×§')`, link: "https://www.google.com/maps/search/?api=1&query=Dajti+Express", notes: "×¢×œ×™×” ×‘×¨×›×‘×œ ×œ×”×¨ ×“××™×˜×™ ×¢× × ×•×£ ×œ×˜×™×¨× ×”." },
        { type: "mandatory", text: `××•××’×” ××œ×‘× ×™×” (×›-${milesToKm(11.6)} ×§"× ××“××™×˜×™ ××§×¡×¤×¨×¡, 23 ×“×§')`, link: "https://www.google.com/maps/search/?api=1&query=Zipline+Albania", notes: "×¢×•×“ ××•××’×” ×›×™×¤×™×ª!" },
        { type: "mandatory", text: "×¦'×§-××™×Ÿ ×‘×“×™×¨×” ×‘-8F6M+3CC, ×“×•×¨×¡", notes: "" },
      ],
      lodgingId: "lodging3"
    },
    {
      date: "×™×•× ×©× ×™, 1 ×‘×¡×¤×˜××‘×¨",
      hebrewDate: "×™×•× ×©× ×™",
      description: "×’×©×¨×™×",
      activities: [
        { type: "mandatory", text: "×¦'×§-×××•×˜ ××”×“×™×¨×” ×‘-8F6M+3CC", notes: "" },
        { type: "mandatory", text: `× ×¡×™×¢×” ×œ×“×™×¨×” ×‘-Hakuna Matata Residence & Apartments, ×•×œ×•×¨×” (×›-${milesToKm(140)} ×§"×, 4 ×©' 10 ×“×§')`, notes: "" },
        { type: "mandatory", text: `×’×©×¨ ×‘×¨××˜××™ (×›-${milesToKm(93.9)} ×§"× ×-8F6M+3CC, 2 ×©' 21 ×“×§')`, link: "https://www.google.com/maps/search/?api=1&query=Gorica+Bridge+Berat", notes: "×’×©×¨ ×¢×ª×™×§ ×•×™×¤×” ×‘×‘×¨××˜." },
        { type: "mandatory", text: `×’×©×¨ ×–×‘×¨× ×¥ (×›-${milesToKm(10.2)} ×§"× ×-Hakuna Matata, 24 ×“×§')`, link: "https://www.google.com/maps/search/?api=1&query=Zvernec+Monastery", notes: "×’×©×¨ ×¢×¥ ×”××•×‘×™×œ ×œ×× ×–×¨ ×‘××™ ×§×˜×Ÿ." },
        { type: "mandatory", text: "×¦'×§-××™×Ÿ ×‘×“×™×¨×” ×‘-Hakuna Matata Residence & Apartments, ×•×œ×•×¨×”", notes: "" },
      ],
      lodgingId: "lodging4"
    },
    {
      date: "×™×•× ×©×œ×™×©×™, 2 ×‘×¡×¤×˜××‘×¨",
      hebrewDate: "×™×•× ×©×œ×™×©×™",
      description: "×˜×™×•×œ ×’×“×•×œ ×‘×•×œ×•×¨×”",
      activities: [
        { type: "mandatory", text: `×˜×™×•×œ ×¡×™×¨×” ×¢× TripMe.Today Boat Tour & Boat Trips Vlore (×›-${milesToKm(32)} ×§"× ×-Hakuna Matata, 7 ×“×§') - <a href="https://www.tripme.today/en_GB/activity/298525/speedboat-ticket-for-grand-tour-national-park-grama-bay." target="_blank" rel="noopener noreferrer">×¤×¨×˜×™× × ×•×¡×¤×™×</a>`, notes: "×¡×™×•×¨ ×™××™ ××•××œ×¥ ×‘××¤×¨×¥ ×•×œ×•×¨×”." },
      ],
      lodgingId: "lodging4"
    },
    {
      date: "×™×•× ×¨×‘×™×¢×™, 3 ×‘×¡×¤×˜××‘×¨",
      hebrewDate: "×™×•× ×¨×‘×™×¢×™",
      description: "×¢×™×Ÿ ×›×—×•×œ×”, ×¢×™×¨ × ×—××“×”",
      activities: [
        { type: "mandatory", text: `× ×¡×™×¢×” ×œ×’'×™×¨×•×§×¡×˜×¨×” (×›-${milesToKm(83.9)} ×§"× ×-Hakuna Matata, 2 ×©' 3 ×“×§')`, notes: `×¢×™×¨ ××‘×Ÿ ×™×¤×”×¤×™×™×”, ××ª×¨ ××•×¨×©×ª ×¢×•×œ××™×ª ×©×œ ××•× ×¡×§"×•.` },
        { type: "mandatory", text: `×‘×™×§×•×¨ ×‘'×¢×™×Ÿ ×”×›×—×•×œ×”' (The Blue Eye) (×›-${milesToKm(22.6)} ×§"× ××’'×™×¨×•×§×¡×˜×¨×”, 1 ×©' 12 ×“×§')`, link: "https://www.google.com/maps/search/?api=1&query=Blue+Eye+Albania", notes: "××¢×™×™×Ÿ ××™× ×¦×œ×•×œ×™× ×‘×¦×‘×¢ ×›×—×•×œ ×¢××•×§." },
        { type: "mandatory", text: `×—×–×¨×” ×œ×“×™×¨×” ×‘-Hakuna Matata Residence & Apartments (×›-${milesToKm(110)} ×§"×, 3 ×©' 11 ×“×§')`, notes: "" },
      ],
      lodgingId: "lodging4"
    },
    {
      date: "×™×•× ×—××™×©×™, 4 ×‘×¡×¤×˜××‘×¨",
      hebrewDate: "×™×•× ×—××™×©×™",
      description: "××‘×•×‘×™× ×•××¨×—×¦××•×ª ×ª×¨××™×™×",
      activities: [
        { type: "mandatory", text: `×‘×™×§×•×¨ ×‘× ×§×•×“×ª ×ª×¦×¤×™×ª ×§× ×™×•×Ÿ ××•×¡×•××™ (Osumi Canyon viewing point) (×›-${milesToKm(101)} ×§"× ×-Hakuna Matata, 2 ×©' 39 ×“×§') - <a href="https://www.getyourguide.com/corovoda-1185185/corovoda-osumi-canyon-raftingriver-tubing-tour-t681710/" target="_blank" rel="noopener noreferrer">×¤×¨×˜×™× × ×•×¡×¤×™×</a>`, notes: "× ×•×£ ×¢×•×¦×¨ × ×©×™××” ×©×œ ×”×§× ×™×•×Ÿ, ××¤×©×¨×•×ª ×œ×¨×¤×˜×™× ×’/××‘×•×‘×™×." },
        { type: "mandatory", text: `×—×–×¨×” ×œ×“×™×¨×” ×‘-Hakuna Matata Residence & Apartments (×›-${milesToKm(101)} ×§"×, 2 ×©' 41 ×“×§')`, notes: "" },
      ],
      lodgingId: "lodging4"
    },
    {
      date: "×™×•× ×©×™×©×™, 5 ×‘×¡×¤×˜××‘×¨",
      hebrewDate: "×™×•× ×©×™×©×™",
      description: "××§×•× ×©×•×•×” ×œ×©×‘×ª",
      activities: [
        { type: "mandatory", text: "×©×”×™×™×” ×‘×“×™×¨×” ×‘-Hakuna Matata Residence & Apartments", notes: "" }
      ],
      lodgingId: "lodging4"
    },
    {
      date: "×™×•× ×©×‘×ª, 6 ×‘×¡×¤×˜××‘×¨",
      hebrewDate: "×™×•× ×©×‘×ª",
      description: "×™×•× ×—×•×¤×©×™ ×‘×•×œ×•×¨×”",
      activities: [
        { type: "mandatory", text: "×©×”×™×™×” ×‘×“×™×¨×” ×‘-Hakuna Matata Residence & Apartments", notes: "" }
      ],
      lodgingId: "lodging4"
    },
    {
      date: "×™×•× ×¨××©×•×Ÿ, 7 ×‘×¡×¤×˜××‘×¨",
      hebrewDate: "×™×•× ×¨××©×•×Ÿ",
      description: "×”×™×•× ×©×—×•×–×¨×™× ×‘×•",
      activities: [
        { type: "mandatory", text: "×¦'×§-×××•×˜ ××”×“×™×¨×” ×‘-Hakuna Matata Residence & Apartments", notes: "" },
        { type: "mandatory", text: `× ×¡×™×¢×” ×œ-VT Rentals ×‘×˜×™×¨× ×” (×›-${milesToKm(102)} ×§"×, 2 ×©' 12 ×“×§')`, notes: "" },
        { type: "mandatory", text: "×”×—×–×¨×ª ×¨×›×‘ ×©×›×•×¨ ×‘×˜×™×¨× ×” (13:00)", notes: "" },
        { type: "mandatory", text: "×˜×™×¡×” ××˜×™×¨× ×” ×œ×ª×œ ××‘×™×‘-×™×¤×• (EL AL LY 5484)", time: "15:35 - 19:10", notes: "" }
      ],
      lodgingId: null // No lodging this night
    }
  ],
  generalOptionalActivities: {
    shkoder: [
      { text: "×¤××¨×§ ××’× ×©×§×•×“×¨×”", link: "https://www.google.com/maps/search/?api=1&query=Lake+Shkoder+National+Park", notes: "×¤××¨×§ ×™×¤×”×¤×” ×¢×œ ×’×“×•×ª ×”××’×." },
      { text: "×˜×™×¨×ª ×¨×•×–××¤×”", link: "https://www.google.com/maps/search/?api=1&query=Rozafa+Castle+Shkoder", notes: "×˜×™×¨×” ×¢×ª×™×§×” ×¢× × ×•×£ ×¤× ×•×¨××™." },
      { text: "Shega e Eger", link: "https://www.google.com/maps/search/?api=1&query=Shega+Eger+Shkoder", notes: "××¡×¢×“×” ××§×•××™×ª ××•××œ×¦×ª ×‘×©×§×•×“×¨×”." },
      { text: "Goje Gaditese", link: "https://www.google.com/maps/search/?api=1&query=Goje+Gaditese+Shkoder", notes: "××§×•× ×—× ×•×™×“×™×“×•×ª×™ ×¢× ×ª×¤×¨×™×˜ ××’×•×•×Ÿ." },
    ],
    durres: [
      { text: "×§×¨×•×™×” (×× ×™×–×¨×•×)", link: "https://www.google.com/maps/search/?api=1&query=Kruja+Castle", notes: "×¢×™×¨ ×”×™×¡×˜×•×¨×™×ª ×¢× ×©×•×§ ×•×˜×™×¨×”." },
      { text: "Grand Hotel - Beach Bar", link: "https://www.google.com/maps/search/?api=1&query=Albanian+Star+Hotel+Beach+Bar+Durres", notes: "×‘×¨ ×—×•×£ ×ª×•×¡×¡ ×¢× × ×•×£ ×œ×™×." },
    ],
    vlore: [
      { text: "Pescheria (××§×•× ×œ×§× ×•×ª ×“×’×™× ×˜×¨×™×™×)", link: "https://www.google.com/maps/search/?api=1&query=Poseidon+fish+market+Vlora", notes: "×©×•×§ ×“×’×™× ××§×•××™ ×•×’×¨×™×œ ×¢× ×“×’×™× ×˜×¨×™×™×." },
      { text: "MarÃ©a Supermarket (×¡×•×¤×¨)", link: "https://www.google.com/maps/search/?api=1&query=Marea+Supermarket+Vlore", notes: "×¡×•×¤×¨××¨×§×˜ ×’×“×•×œ ×¢× ××’×•×•×Ÿ ××•×¦×¨×™×." },
      { text: "Lime Lounge Cocktail Bar (×‘×¨ ××’× ×™×‘ ××‘×œ ×™×§×¨, ××¨×—×§ ×”×œ×™×›×”)", link: "https://www.google.com/maps/search/?api=1&query=Lime+Lounge+Cocktail+Bar+Vlore", notes: "×‘×¨ ×§×•×§×˜×™×™×œ×™× ×™×•×§×¨×ª×™ ×¢× ××•×•×™×¨×” ×ª×•×¡×¡×ª." },
      { text: "ROOFTOP - Lounge Bar (×‘×¨ ×‘××—×™×¨ ×¡×‘×™×¨ ×¢×œ ×”×’×’, ××¨×—×§ ×”×œ×™×›×”)", link: "https://www.google.com/maps/search/?api=1&query=ROOFTOP+Lounge+Bar+Vlore", notes: "×‘×¨ ×’×’ ×¢× × ×•×£ ×¤× ×•×¨××™ ××¨×”×™×‘." },
      { text: "Xhino Beach Bar (××§×•× ××’× ×™×‘, ×¦×¨×™×š ×œ× ×¡×•×¢)", link: "https://www.google.com/maps/search/?api=1&query=Xhino+Beach+Bar+Vlore", notes: "×‘×¨ ×—×•×£ ×ª×•×¡×¡ ×¢× × ×•×£ ×©×§×™×¢×” ××”××." },
      { text: "Komiteti Bar - VlorÃ« (×–×•×œ ×•×—××•×“, ×¦×¨×™×š ×œ× ×¡×•×¢)", link: "https://www.google.com/maps/search/?api=1&query=Komiteti+Bar+Vlore", notes: "×‘×¨ ×‘×•×˜×™×§ ×–×•×œ ×•×—××•×“ ×¢× ×¢×™×¦×•×‘ ××™×•×—×“." },
      { text: "Black Moon Lounge (××—×™×¨×™× ×¡×‘×™×¨×™×)", link: "https://www.google.com/maps/search/?api=1&query=Black+Moon+Lounge+Vlore", notes: "×œ××•× ×’' ×‘×¨ ×¢× ××•×–×™×§×” ×˜×•×‘×” ×•××—×™×¨×™× ×¡×‘×™×¨×™×." },
      { text: "Olympia Bar VlorÃ« (××§×•× ××’× ×™×‘, ××—×™×¨×™× ×¡×‘×™×¨×™×)", link: "https://www.google.com/maps/search/?api=1&query=Olympia+Bar+Vlore", notes: "×‘×¨ ×¤×•×¤×•×œ×¨×™ ×¢× ××•×•×™×¨×” ×ª×•×¡×¡×ª." },
      { text: "Kuzum Baba (××§×•× ×™×¤×” ×œ×¨××•×ª ××× ×• ××ª ×”×©×§×™×¢×”)", link: "https://www.google.com/maps/search/?api=1&query=Kuzum+Baba+Vlore", notes: "× ×§×•×“×ª ×ª×¦×¤×™×ª ××•×©×œ××ª ×œ×©×§×™×¢×”." },
      { text: "Lungomare beach (×˜×™×™×œ×ª)", link: "https://www.google.com/maps/search/?api=1&query=Lungomare+Vlore", notes: "×˜×™×™×œ×ª ×—×•×£ ××¨×•×›×” ×•× ×¢×™××”." },
    ],
    gjirokaster: [
      { text: "××¨×—×¦××•×ª ×ª×¨××™×™× Llixhat e BÃ«njÃ«s", link: "https://www.google.com/maps/search/?api=1&query=Llixhat+e+B%C3%ABnj%C3%ABs", notes: "××¢×™×™× ×•×ª ×—××™× ×˜×‘×¢×™×™×." },
      { text: "×˜×™×¨×ª ×’'×™×¨×•×§×¡×˜×¨×”", link: "https://www.google.com/maps/search/?api=1&query=Gjirokaster+Castle", notes: "×˜×™×¨×” ××¨×©×™××” ×”××©×§×™×¤×” ×¢×œ ×”×¢×™×¨." },
      { text: "×©×•×§ ×’'×™×¨×•×§×¡×˜×¨×”", link: "https://www.google.com/maps/search/?api=1&query=Gjirokaster+Old+Bazaar", notes: "×©×•×§ ××§×•××™ ×¢×ª×™×§ ×¢× ×¢×‘×•×“×•×ª ×™×“ ×•××–×›×¨×•×ª." },
      { text: "×’×©×¨ ×¢×œ×™ ×¤××©×”", link: "https://www.google.com/maps/search/?api=1&query=Ali+Pasha+Bridge+Gjirokaster", notes: "×’×©×¨ ××‘×Ÿ ×¢×ª×™×§." }
    ],
    beaches: [
      { text: "×—×•×£ ×’'×™×¤×” (×œ× ×—×•×‘×”, ×›×™ ×”×—×•×¤×™× ×œ×™×“ ×”×“×™×¨×” ×’× ×™×¤×™×)", link: "https://www.google.com/maps/search/?api=1&query=Gjipe+Beach", notes: "×—×•×£ ××‘×•×“×“ ×•×™×¤×”×¤×”." },
      { text: "DhÃ«rmiu Beach", link: "https://www.google.com/maps/search/?api=1&query=Dhermiu+Beach", notes: "××—×“ ×”×—×•×¤×™× ×”×¤×•×¤×•×œ×¨×™×™× ×‘×¨×™×‘×™×™×¨×” ×”××œ×‘× ×™×ª." },
      { text: "Plazhi Ksamilit (×¨×—×•×§)", link: "https://www.google.com/maps/search/?api=1&query=Ksamil+Beach", notes: "×—×•×¤×™× ×˜×¨×•×¤×™×™× ×¢× ××™×™× ×§×˜× ×™×." },
      { text: "Jale Beach (×¡×¤×•×¨×˜ ×™××™)", link: "https://www.google.com/maps/search/?api=1&query=Jale+Beach", notes: "×—×•×£ ×¢× ××¤×©×¨×•×™×•×ª ×œ×¡×¤×•×¨×˜ ×™××™." },
    ],
    tirana: [
      { text: `××¡×œ×•×œ ×˜×™×•×œ ×‘×˜×™×¨× ×”: Maja e Tujanit - <a href="https://www.alltrails.com/trail/albania/tirana/maja-e-tujanit" target="_blank" rel="noopener noreferrer">×¤×¨×˜×™× × ×•×¡×¤×™×</a>`, notes: "××¡×œ×•×œ ×˜×™×•×œ ×‘×”×¨ ×œ×™×“ ×˜×™×¨× ×”." },
      { text: `××¡×œ×•×œ ×˜×™×•×œ ×‘×˜×™×¨× ×”: WalkableCrossroad - ×¡×‘×™×‘ ××’× ×˜×™×¨× ×” - <a href="https://www.alltrails.com/trail/albania/durres/ligeni-i-tiranes" target="_blank" rel="noopener noreferrer">×¤×¨×˜×™× × ×•×¡×¤×™×</a>`, notes: "×”×œ×™×›×” × ×¢×™××” ×¡×‘×™×‘ ××’× ×˜×™×¨× ×”." }
    ]
  },
  packingList: {
    clothing: ["×‘×’×“×™ ×˜×™×•×œ", "× ×¢×œ×™ ×”×œ×™×›×”", "×’'×§×˜", "×›×•×‘×¢", "××©×§×¤×™ ×©××©", "×‘×’×“ ×™×"],
    toiletries: ["××‘×¨×©×ª ×©×™× ×™×™×", "××˜×¢×Ÿ", "××•×–× ×™×•×ª", "××™× ×•×§×¡×™×“×™×œ", "×©×¢×•×Ÿ"],
    food: ["×¤×™×¦×” ×§×¤×•××”", "×’×‘×™× ×” ×¦×”×•×‘×”", "×ª×‘×œ×™× ×™×", "×¤× ×§×™×™×§ ××™× ×¡×˜× ×˜", "×—×˜×™×¤×™×", "×‘×•×¨×§×¡"],
    cooking: ["××—×‘×ª", "×¡×™×¨", "×¡×›×•\"×", "×§×¢×¨×”"],
    miscellaneous: ["×ª×¤×™×œ×™×Ÿ", "×“×¨×›×•×Ÿ", "×¨×™×©×™×•×Ÿ × ×”×™×’×” (×•×‘×™× ×œ××•××™)", "×›×¨×˜×™×¡ ××©×¨××™"]
  },
  budget: {
    totalBudgetILS: 10000.00,
    expenses: [
      { category: "×˜×™×¡×•×ª", item: "××œ ×¢×œ 5483", amount: 683.00, currency: "ILS" },
      { category: "×˜×™×¡×•×ª", item: "××œ ×¢×œ 5484", amount: 683.00, currency: "ILS" },
      { category: "×œ×™× ×”", item: "Rruga Edith Durham 25", amount: 136.00, currency: "ILS" },
      { category: "×œ×™× ×”", item: "North Alpine Villas", amount: 1179.00, currency: "ILS" },
      { category: "×œ×™× ×”", item: "8F6M+3CC", amount: 125.00, currency: "ILS" },
      { category: "×œ×™× ×”", item: "Hakuna Matata Residence & Apartments", amount: 1966.00, currency: "ILS" },
      { category: "×¤×¢×™×œ×•×™×•×ª", item: "Osumi Canyon viewing point", amount: 80.00, currency: "EUR" },
      { category: "×¤×¢×™×œ×•×™×•×ª", item: "TripMe.Today Boat Tour & Boat Trips Vlore", amount: 110.00, currency: "EUR" },
      { category: "×¤×¢×™×œ×•×™×•×ª", item: "Dajti Ekspres", amount: 28.00, currency: "EUR" },
      { category: "×¤×¢×™×œ×•×™×•×ª", item: "Zipline Albania", amount: 2000.00, currency: "ALL" },
      { category: "×¤×¢×™×œ×•×™×•×ª", item: "Thethi Zipline", amount: 2000.00, currency: "ALL" },
      { category: "×¨×›×‘ ×©×›×•×¨", item: "Rent a Car in Tirana - VT Rentals", amount: 310.00, currency: "EUR" },
      { category: "××—×¨", item: "Camping_Private Kabine (room) NORTH ALBANIA", amount: 10.00, currency: "EUR" }
    ]
  }
};

// Exchange rates (approximate for demonstration)
const exchangeRates = {
  EUR_TO_ILS: 4.0, // 1 EUR = 4.0 ILS
  ALL_TO_ILS: 0.038 // 1 ALL = 0.038 ILS
};

// Function to convert to ILS
const convertToILS = (amount, currency) => {
  if (currency === "ILS") return amount;
  if (currency === "EUR") return amount * exchangeRates.EUR_TO_ILS;
  if (currency === "ALL") return amount * exchangeRates.ALL_TO_ILS;
  return 0; // Should not happen
};

// Hero Section Component
const Hero = ({ title, dates }) => (
  <section id="hero" className="relative h-screen flex items-center justify-center text-white rounded-xl shadow-lg"
    // Changed to a green gradient background for a cohesive look
    style={{ background: 'linear-gradient(to right, #16a34a 0%, #34d399 100%)' }}> {/* Using green-600 and green-400 */}
    <div className="absolute inset-0 bg-black opacity-50 rounded-xl"></div>
    <div className="relative z-10 text-center p-8 bg-black bg-opacity-40 rounded-xl">
      <h1 className="text-6xl md:text-8xl font-extrabold mb-4 drop-shadow-lg text-yellow-300">{title}</h1>
      <p className="text-2xl md:text-4xl font-semibold">{dates}</p>
    </div>
  </section>
);

// Navbar Component
const Navbar = () => {
  const [isOpen, setIsOpen] = useState(false);

  const scrollToSection = (id) => {
    const element = document.getElementById(id);
    if (element) {
      element.scrollIntoView({ behavior: 'smooth' });
      setIsOpen(false); // Close mobile menu after clicking
    }
  };

  return (
    <nav className="sticky top-0 z-50 bg-gradient-to-r from-green-600 to-green-800 p-4 shadow-lg rounded-b-xl"> {/* Changed to green shades */}
      <div className="container mx-auto flex justify-between items-center">
        <div className="text-white text-2xl font-bold">
          <a href="#hero" onClick={() => scrollToSection('hero')} className="hover:text-yellow-300 transition duration-300">×”×˜×™×•×œ ×©×œ×™</a>
        </div>
        <div className="md:hidden">
          <button onClick={() => setIsOpen(!isOpen)} className="text-white focus:outline-none">
            <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              {isOpen ? (
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12"></path>
              ) : (
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6h16M4 12h16M4 18h16"></path>
              )}
            </svg>
          </button>
        </div>
        <div className={`md:flex ${isOpen ? 'block' : 'hidden'} w-full md:w-auto`}>
          <ul className="flex flex-col md:flex-row md:space-x-8 mt-4 md:mt-0 items-center">
            {['itinerary', 'packing-list', 'budget', 'general-optional-activities', 'currency-converter'].map((id) => (
              <li key={id}>
                <a
                  href={`#${id}`}
                  onClick={() => scrollToSection(id)}
                  className="block py-2 px-4 text-white hover:text-yellow-300 transition duration-300 text-lg font-medium rounded-lg"
                >
                  {id === 'itinerary' && '××¡×œ×•×œ ×”×˜×™×•×œ'}
                  {id === 'packing-list' && '×¨×©×™××ª ×¦×™×•×“'}
                  {id === 'budget' && '×ª×§×¦×™×‘'}
                  {id === 'general-optional-activities' && '×¤×¢×™×œ×•×™×•×ª ××•×¤×¦×™×•× ×œ×™×•×ª'}
                  {id === 'currency-converter' && '××—×©×‘×•×Ÿ ××˜×‘×¢'}
                </a>
              </li>
            ))}
          </ul>
        </div>
      </div>
    </nav>
  );
};

// Itinerary Section Component
const Itinerary = ({ itinerary, lodging, carRental }) => {
  const [openDay, setOpenDay] = useState(null); // State to manage which day's details are open
  // State to manage temporary notes for activities, loaded from localStorage
  const [activityNotes, setActivityNotes] = useState(() =>
    loadFromLocalStorage('itineraryNotes', {})
  );

  // State to manage temporary images for activities, loaded from localStorage
  const [activityImages, setActivityImages] = useState(() =>
    loadFromLocalStorage('itineraryImages', {})
  );

  // State to manage the collapsed/expanded state of notes/image sections within each activity
  const [openActivityDetails, setOpenActivityDetails] = useState(() =>
    loadFromLocalStorage('openActivityDetails', {})
  );

  // Save notes to localStorage whenever they change
  useEffect(() => {
    saveToLocalStorage('itineraryNotes', activityNotes);
  }, [activityNotes]);

  // Save images to localStorage whenever they change
  useEffect(() => {
    saveToLocalStorage('itineraryImages', activityImages);
  }, [activityImages]);

  // Save openActivityDetails state to localStorage whenever it changes
  useEffect(() => {
    saveToLocalStorage('openActivityDetails', openActivityDetails);
  }, [openActivityDetails]);

  const toggleDay = (index) => {
    setOpenDay(openDay === index ? null : index);
  };

  const toggleActivityDetail = (dayIndex, activityIndex) => {
    const key = `${dayIndex}-${activityIndex}`;
    setOpenActivityDetails(prev => ({
      ...prev,
      [key]: !prev[key]
    }));
  };

  const handleNoteChange = (dayIndex, activityIndex, e) => {
    setActivityNotes(prevNotes => ({
      ...prevNotes,
      [`${dayIndex}-${activityIndex}`]: e.target.value
    }));
  };

  const handleImageUpload = (dayIndex, activityIndex, e) => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onloadend = () => {
        setActivityImages(prevImages => ({
          ...prevImages,
          [`${dayIndex}-${activityIndex}`]: reader.result // Save base64 string
        }));
      };
      reader.readAsDataURL(file); // Read file as base64
    }
  };

  return (
    <section id="itinerary" className="py-16 bg-gray-100 min-h-screen rounded-xl shadow-lg m-4">
      <div className="container mx-auto px-4">
        <h2 className="text-5xl font-bold text-center mb-12 text-green-700 drop-shadow-md"> {/* Changed to green-700 */}
          <i className="lucide lucide-map-pin inline-block align-middle mr-4"></i>
          ××¡×œ×•×œ ×”×˜×™×•×œ
        </h2>
        <div className="space-y-8">
          {itinerary.map((day, index) => {
            const currentLodging = day.lodgingId ? lodging.find(l => l.id === day.lodgingId) : null;
            const isCarPickupDay = day.date === carRental.pickup.date;
            const isCarDropoffDay = day.date === carRental.dropoff.date;

            return (
              <div
                key={index}
                className="bg-white p-8 rounded-2xl shadow-xl hover:shadow-2xl transition-all duration-300 cursor-pointer border-t-4 border-green-500" // Changed to green-500
                onClick={() => toggleDay(index)}
              >
                <div className="flex justify-between items-center mb-4">
                  <h3 className="text-3xl font-semibold text-gray-800 flex items-center">
                    <span className="text-green-600 mr-3">ğŸ“…</span> {/* Changed to green-600 */}
                    {day.date}: {day.description}
                  </h3>
                  <button className="text-green-500 hover:text-green-700 transition-colors duration-300"> {/* Changed to green-500, green-700 */}
                    {openDay === index ? (
                      <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 15l7-7 7 7"></path></svg>
                    ) : (
                      <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7"></path></svg>
                    )}
                  </button>
                </div>

                {openDay === index && (
                  <div className="mt-6 border-t pt-6 border-gray-200">
                    <ul className="space-y-4 text-lg text-gray-700">
                      {isCarPickupDay && (
                        <li className="flex items-start text-green-700 font-medium">
                          <span className="text-2xl mr-3">ğŸš—</span>
                          <div>
                            <strong>××™×¡×•×£ ×¨×›×‘:</strong> {carRental.name} ×‘-{carRental.pickup.location} ×‘×©×¢×” {carRental.pickup.time}
                          </div>
                        </li>
                      )}
                      {isCarDropoffDay && (
                        <li className="flex items-start text-red-700 font-medium">
                          <span className="text-2xl mr-3">ğŸš—</span>
                          <div>
                            <strong>×”×—×–×¨×ª ×¨×›×‘:</strong> {carRental.name} ×‘-{carRental.dropoff.location} ×‘×©×¢×” {carRental.dropoff.time}
                          </div>
                        </li>
                      )}
                      {day.activities.map((activity, activityIdx) => {
                        const activityDetailKey = `${index}-${activityIdx}`;
                        const isDetailOpen = openActivityDetails[activityDetailKey];
                        return (
                          <li key={activityIdx} className={`flex flex-col items-start p-4 rounded-lg ${activity.type === 'optional' ? 'bg-gray-50 text-gray-500' : 'bg-green-50 text-gray-700'}`}> {/* Changed to green-50 */}
                            <div className="flex items-center w-full mb-2">
                              <span className="text-2xl mr-3">
                                {activity.type === 'mandatory' ? 'âœ…' : 'ğŸ’¡'}
                              </span>
                              <div className="flex-grow" dangerouslySetInnerHTML={{ __html: activity.text }} />
                              {activity.time && <span className="font-medium mr-2"> ({activity.time})</span>}
                              {activity.type === 'optional' && <span className="text-sm ml-2">(××•×¤×¦×™×•× ×œ×™)</span>}
                            </div>
                            {activity.link && (
                              <a
                                href={activity.link}
                                target="_blank"
                                rel="noopener noreferrer"
                                className="inline-flex items-center px-4 py-2 bg-green-500 text-white text-sm font-semibold rounded-full hover:bg-green-600 transition-colors duration-300 shadow-md mt-2" // Changed to green shades
                              >
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-map-pin mr-2"><path d="M12 18.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Z"/><path d="M12 22v-3.5"/><path d="M12 11.5V2"/><path d="M19 12h3"/><path d="M2 12h3"/><path d="M12 2a7 7 0 1 0 7 7"/></svg>
                                × ×•×•×˜
                              </a>
                            )}

                            <div className="w-full mt-4 border-t border-gray-200 pt-4">
                              <div
                                className="flex justify-between items-center cursor-pointer"
                                onClick={() => toggleActivityDetail(index, activityIdx)}
                              >
                                <h4 className="text-base font-medium text-gray-700 flex items-center">
                                  <span className="text-xl mr-2">ğŸ“</span>
                                  ×”×¢×¨×•×ª ×•×ª××•× ×•×ª
                                </h4>
                                <button className="text-gray-500 hover:text-gray-700 transition-colors duration-300">
                                  {isDetailOpen ? (
                                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 15l7-7 7 7"></path></svg>
                                  ) : (
                                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7"></path></svg>
                                  )}
                                </button>
                              </div>

                              {isDetailOpen && (
                                <div className="mt-4">
                                  <label htmlFor={`notes-${index}-${activityIdx}`} className="block text-sm font-medium text-gray-700 mb-1">
                                    ×”×¢×¨×•×ª:
                                  </label>
                                  <textarea
                                    id={`notes-${index}-${activityIdx}`}
                                    value={activityNotes[`${index}-${activityIdx}`] || ''}
                                    onChange={(e) => handleNoteChange(index, activityIdx, e)}
                                    className="w-full p-2 border border-gray-300 rounded-md text-sm focus:ring-green-500 focus:border-green-500" // Changed to green shades
                                    rows="3"
                                    placeholder="×”×¢×¨×•×ª ×œ×¤×¢×™×œ×•×ª ×–×• (× ×©××¨×•×ª ×‘×“×¤×“×¤×Ÿ)"
                                  ></textarea>
                                  <p className="text-xs text-green-500 mt-1"> {/* Changed to green-500 */}
                                    *×”×¢×¨×•×ª ××œ×• × ×©××¨×•×ª ×‘××•×¤×Ÿ ××§×•××™ ×‘×“×¤×“×¤×Ÿ.
                                  </p>

                                  <div className="mt-4">
                                    <label htmlFor={`image-upload-${index}-${activityIdx}`} className="block text-sm font-medium text-gray-700 mb-1">
                                      ×”×¢×œ××ª ×ª××•× ×”/×§×•×‘×¥:
                                    </label>
                                    <input
                                      type="file"
                                      id={`image-upload-${index}-${activityIdx}`}
                                      accept="image/*"
                                      onChange={(e) => handleImageUpload(index, activityIdx, e)}
                                      className="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-green-50 file:text-green-700 hover:file:bg-green-100" // Changed to green shades
                                    />
                                    {activityImages[`${index}-${activityIdx}`] && (
                                      <div className="mt-2">
                                        <img
                                          src={activityImages[`${index}-${activityIdx}`]}
                                          alt="Uploaded preview"
                                          className="mt-2 max-w-full h-auto rounded-lg shadow-md"
                                          style={{ maxWidth: '200px' }}
                                        />
                                        <p className="text-xs text-green-500 mt-1"> {/* Changed to green-500 */}
                                          *×”×ª××•× ×” × ×©××¨×ª ×‘××•×¤×Ÿ ××§×•××™ ×‘×“×¤×“×¤×Ÿ.
                                        </p>
                                      </div>
                                    )}
                                  </div>
                                </div>
                              )}
                            </div>
                          </li>
                        );
                      })}
                    </ul>
                    {currentLodging && (
                      <div className="mt-8 p-6 bg-green-50 border border-green-200 rounded-xl shadow-inner"> {/* Changed to green shades */}
                        <h4 className="text-2xl font-bold text-green-700 mb-4 flex items-center"> {/* Changed to green-700 */}
                          <span className="text-3xl mr-3">ğŸ¨</span>
                          ×œ×™× ×”: {currentLodging.type} ×‘-{currentLodging.name}
                        </h4>
                        <p className="text-lg text-green-800 mb-2"> {/* Changed to green-800 */}
                          <strong>×›×ª×•×‘×ª:</strong> {currentLodging.address}
                        </p>
                        <p className="text-lg text-green-800 mb-2"> {/* Changed to green-800 */}
                          <strong>×ª××¨×™×›×™×:</strong> {currentLodging.dates}
                        </p>
                        <p className="text-lg text-green-800 mb-2"> {/* Changed to green-800 */}
                          <strong>××™×©×•×¨ ×”×–×× ×”:</strong> {currentLodging.confirmation}
                        </p>
                        {currentLodging.contact && (
                          <a
                            href={currentLodging.contact}
                            target="_blank"
                            rel="noopener noreferrer"
                            className="inline-flex items-center text-green-600 hover:text-green-800 font-semibold transition-colors duration-300 mt-2" // Changed to green shades
                          >
                            <span className="text-xl mr-2">ğŸ“</span>
                            ×¦×•×¨ ×§×©×¨ ×¢× ×”×“×™×¨×”
                          </a>
                        )}
                      </div>
                    )}
                  </div>
                )}
              </div>
            );
          })}
        </div>
      </div>
    </section>
  );
};

// Packing List Section Component
const PackingList = ({ packingList }) => (
  <section id="packing-list" className="py-16 bg-gradient-to-br from-green-50 to-green-100 min-h-screen rounded-xl shadow-lg m-4"> {/* Changed to green-100 */}
    <div className="container mx-auto px-4">
      <h2 className="text-5xl font-bold text-center mb-12 text-green-700 drop-shadow-md">
        <i className="lucide lucide-baggage-claim inline-block align-middle mr-4"></i>
        ×¨×©×™××ª ×¦×™×•×“
      </h2>
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {Object.entries(packingList).map(([category, items]) => (
          <div key={category} className="bg-white p-8 rounded-2xl shadow-xl border-t-4 border-green-500">
            <h3 className="text-3xl font-semibold text-gray-800 mb-6 capitalize flex items-center">
              <span className="text-green-600 mr-3">
                {category === 'clothing' && 'ğŸ‘•'}
                {category === 'toiletries' && 'ğŸ§´'}
                {category === 'food' && 'ğŸ'}
                {category === 'cooking' && 'ğŸ³'}
                {category === 'miscellaneous' && 'ğŸ’'}
              </span>
              {category === 'clothing' && '×‘×™×’×•×“'}
              {category === 'toiletries' && '×˜×•××œ×˜×™×§×” ×•××™×©×™'}
              {category === 'food' && '×¤×¨×™×˜×™ ××–×•×Ÿ'}
              {category === 'cooking' && '×›×œ×™ ×‘×™×©×•×œ'}
              {category === 'miscellaneous' && '×©×•× ×•×ª'}
            </h3>
            <ul className="space-y-3 text-lg text-gray-700">
              {items.map((item, index) => (
                <li key={index} className="flex items-center">
                  <input
                    type="checkbox"
                    id={`item-${category}-${index}`}
                    className="form-checkbox h-6 w-6 text-green-600 rounded-md border-gray-300 focus:ring-green-500"
                  />
                  <label htmlFor={`item-${category}-${index}`} className="ml-3 cursor-pointer">
                    {item}
                  </label>
                </li>
              ))}
            </ul>
          </div>
        ))}
      </div>
    </div>
  </section>
);

// Budget Section Component
const Budget = ({ budget }) => {
  // Calculate total expenses in ILS and categorize them
  const categorizedExpenses = {};
  budget.expenses.forEach(exp => {
    const amountILS = convertToILS(exp.amount, exp.currency);
    categorizedExpenses[exp.category] = (categorizedExpenses[exp.category] || 0) + amountILS;
  });

  const pieChartData = Object.entries(categorizedExpenses).map(([category, amount]) => ({
    name: category,
    value: parseFloat(amount.toFixed(2))
  }));

  const COLORS = ['#16a34a', '#34d399', '#84cc16', '#a3e635', '#4ade80', '#22c55e']; // Updated to green shades

  const totalActualExpenses = pieChartData.reduce((sum, entry) => sum + entry.value, 0);

  return (
    <section id="budget" className="py-16 bg-gray-100 min-h-screen rounded-xl shadow-lg m-4">
      <div className="container mx-auto px-4">
        <h2 className="text-5xl font-bold text-center mb-12 text-green-700 drop-shadow-md"> {/* Changed to green-700 */}
          <i className="lucide lucide-wallet inline-block align-middle mr-4"></i>
          ×ª×§×¦×™×‘ ×”×˜×™×•×œ
        </h2>
        <div className="bg-white p-8 rounded-2xl shadow-xl border-t-4 border-green-500"> {/* Changed to green-500 */}
          <div className="flex flex-col md:flex-row items-center justify-around mb-8">
            <div className="text-center p-4 bg-green-50 rounded-xl shadow-inner mb-4 md:mb-0 w-full md:w-1/3"> {/* Changed to green-50 */}
              <h3 className="text-2xl font-semibold text-green-800">×ª×§×¦×™×‘ ×›×•×œ×œ</h3> {/* Changed to green-800 */}
              <p className="text-4xl font-bold text-green-600">â‚ª{budget.totalBudgetILS.toLocaleString()}</p> {/* Changed to green-600 */}
            </div>
            <div className="text-center p-4 bg-green-50 rounded-xl shadow-inner w-full md:w-1/3"> {/* Changed to green-50 */}
              <h3 className="text-2xl font-semibold text-green-800">×”×•×¦××•×ª ×‘×¤×•×¢×œ</h3> {/* Changed to green-800 */}
              <p className="text-4xl font-bold text-green-600">â‚ª{totalActualExpenses.toLocaleString()}</p> {/* Changed to green-600 */}
            </div>
          </div>

          <h3 className="text-3xl font-semibold text-gray-800 mb-6 text-center">×”×ª×¤×œ×’×•×ª ×”×•×¦××•×ª</h3>
          <ResponsiveContainer width="100%" height={400}>
            <PieChart>
              <Pie
                data={pieChartData}
                cx="50%"
                cy="50%"
                labelLine={false}
                outerRadius={150}
                fill="#8884d8"
                dataKey="value"
                label={({ name, percent }) => `${name}: ${(percent * 100).toFixed(0)}%`}
              >
                {pieChartData.map((entry, index) => (
                  <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                ))}
              </Pie>
              <Tooltip formatter={(value) => `â‚ª${value.toLocaleString()}`} />
              <Legend />
            </PieChart>
          </ResponsiveContainer>
        </div>
      </div>
    </section>
  );
};

// General Optional Activities Section Component
const GeneralOptionalActivities = ({ activities }) => {
  // State to manage temporary images for optional activities, loaded from localStorage
  const [optionalActivityImages, setOptionalActivityImages] = useState(() =>
    loadFromLocalStorage('optionalActivityImages', {})
  );

  // State to manage the collapsed/expanded state of each category
  const [openCategories, setOpenCategories] = useState(() =>
    loadFromLocalStorage('openCategories', {})
  );

  // State to manage the collapsed/expanded state of notes/image sections within each optional activity
  const [openOptionalActivityDetails, setOpenOptionalActivityDetails] = useState(() =>
    loadFromLocalStorage('openOptionalActivityDetails', {})
  );

  // Save images to localStorage whenever they change
  useEffect(() => {
    saveToLocalStorage('optionalActivityImages', optionalActivityImages);
  }, [optionalActivityImages]);

  // Save openCategories state to localStorage whenever it changes
  useEffect(() => {
    saveToLocalStorage('openCategories', openCategories);
  }, [openCategories]);

  // Save openOptionalActivityDetails state to localStorage whenever it changes
  useEffect(() => {
    saveToLocalStorage('openOptionalActivityDetails', openOptionalActivityDetails);
  }, [openOptionalActivityDetails]);

  const handleOptionalImageUpload = (location, itemIndex, e) => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onloadend = () => {
        setOptionalActivityImages(prevImages => ({
          ...prevImages,
          [`${location}-${itemIndex}`]: reader.result // Save base64 string
        }));
      };
      reader.readAsDataURL(file); // Read file as base64
    }
  };

  const toggleCategory = (location) => {
    setOpenCategories(prev => ({
      ...prev,
      [location]: !prev[location]
    }));
  };

  const toggleOptionalActivityDetail = (location, itemIndex) => {
    const key = `${location}-${itemIndex}`;
    setOpenOptionalActivityDetails(prev => ({
      ...prev,
      [key]: !prev[key]
    }));
  };

  return (
    <section id="general-optional-activities" className="py-16 bg-gradient-to-br from-green-50 to-green-100 min-h-screen rounded-xl shadow-lg m-4"> {/* Changed to green-100 */}
      <div className="container mx-auto px-4">
        <h2 className="text-5xl font-bold text-center mb-12 text-green-700 drop-shadow-md"> {/* Changed to green-700 */}
          <i className="lucide lucide-compass inline-block align-middle mr-4"></i>
          ×¤×¢×™×œ×•×™×•×ª ××•×¤×¦×™×•× ×œ×™×•×ª ×›×œ×œ×™×•×ª
        </h2>
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
          {Object.entries(activities).map(([location, items]) => (
            <div key={location} className="bg-white p-8 rounded-2xl shadow-xl border-t-4 border-green-500"> {/* Changed to green-500 */}
              <div
                className="flex justify-between items-center mb-6 cursor-pointer"
                onClick={() => toggleCategory(location)}
              >
                <h3 className="text-3xl font-semibold text-gray-800 capitalize flex items-center">
                  <span className="text-green-600 mr-3">ğŸ“</span> {/* Changed to green-600 */}
                  {location === 'shkoder' ? '××–×•×¨ ×©×§×•×“×¨×”' : null}
                  {location === 'durres' ? '××–×•×¨ ×“×•×¨×¡' : null}
                  {location === 'vlore' ? '××–×•×¨ ×•×œ×•×¨×”' : null}
                  {location === 'gjirokaster' ? '××–×•×¨ ×’\'×™×¨×•×§×¡×˜×¨×”' : null}
                  {location === 'beaches' ? '×—×•×¤×™× ××•××œ×¦×™×' : null}
                  {location === 'tirana' ? '××–×•×¨ ×˜×™×¨× ×”' : null}
                </h3>
                <button className="text-green-500 hover:text-green-700 transition-colors duration-300"> {/* Changed to green-500, green-700 */}
                  {openCategories[location] ? (
                    <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 15l7-7 7 7"></path></svg>
                  ) : (
                    <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7"></path></svg>
                  )}
                </button>
              </div>

              {openCategories[location] && (
                <ul className="space-y-3 text-lg text-gray-500">
                  {items.map((item, index) => {
                    const optionalActivityDetailKey = `${location}-${index}`;
                    const isOptionalDetailOpen = openOptionalActivityDetails[optionalActivityDetailKey];
                    return (
                      <li key={index} className="flex flex-col items-start p-4 rounded-lg bg-gray-50">
                        <div className="flex items-center w-full mb-2">
                          <span className="text-2xl mr-3">ğŸ’¡</span>
                          <div className="flex-grow">
                            <strong>{item.notes}</strong><br />
                            <span dangerouslySetInnerHTML={{ __html: item.text }} />
                          </div>
                          <span className="text-sm ml-2">(××•×¤×¦×™×•× ×œ×™)</span>
                        </div>
                        {item.link && (
                          <a
                            href={item.link}
                            target="_blank"
                            rel="noopener noreferrer"
                            className="inline-flex items-center px-4 py-2 bg-green-500 text-white text-sm font-semibold rounded-full hover:bg-green-600 transition-colors duration-300 shadow-md mt-2" // Changed to green shades
                          >
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-map-pin mr-2"><path d="M12 18.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Z"/><path d="M12 22v-3.5"/><path d="M12 11.5V2"/><path d="M19 12h3"/><path d="M2 12h3"/><path d="M12 2a7 7 0 1 0 7 7"/></svg>
                            × ×•×•×˜
                          </a>
                        )}

                        <div className="w-full mt-4 border-t border-gray-200 pt-4">
                          <div
                            className="flex justify-between items-center cursor-pointer"
                            onClick={() => toggleOptionalActivityDetail(location, index)}
                          >
                            <h4 className="text-base font-medium text-gray-700 flex items-center">
                              <span className="text-xl mr-2">ğŸ“</span>
                              ×”×¢×¨×•×ª ×•×ª××•× ×•×ª
                            </h4>
                            <button className="text-gray-500 hover:text-gray-700 transition-colors duration-300">
                              {isOptionalDetailOpen ? (
                                <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 15l7-7 7 7"></path></svg>
                              ) : (
                                <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7"></path></svg>
                              )}
                            </button>
                          </div>

                          {isOptionalDetailOpen && (
                            <div className="mt-4">
                              <label htmlFor={`optional-notes-${location}-${index}`} className="block text-sm font-medium text-gray-700 mb-1">
                                ×”×¢×¨×•×ª:
                              </label>
                              <textarea
                                id={`optional-notes-${location}-${index}`}
                                defaultValue={item.notes || ''} // Use defaultValue for initial, non-controlled state
                                className="w-full p-2 border border-gray-300 rounded-md text-sm focus:ring-green-500 focus:border-green-500" // Changed to green shades
                                rows="3"
                                placeholder="×”×¢×¨×•×ª ×œ×¤×¢×™×œ×•×ª ×–×• (× ×©××¨×•×ª ×‘×“×¤×“×¤×Ÿ)"
                              ></textarea>
                              <p className="text-xs text-green-500 mt-1"> {/* Changed to green-500 */}
                                *×”×¢×¨×•×ª ××œ×• × ×©××¨×•×ª ×‘××•×¤×Ÿ ××§×•××™ ×‘×“×¤×“×¤×Ÿ.
                              </p>

                              <div className="mt-4">
                                <label htmlFor={`optional-image-upload-${location}-${index}`} className="block text-sm font-medium text-gray-700 mb-1">
                                  ×”×¢×œ××ª ×ª××•× ×”/×§×•×‘×¥:
                                </label>
                                <input
                                  type="file"
                                  id={`optional-image-upload-${location}-${index}`}
                                  accept="image/*"
                                  onChange={(e) => handleOptionalImageUpload(location, index, e)}
                                  className="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-green-50 file:text-green-700 hover:file:bg-green-100" // Changed to green shades
                                />
                                {optionalActivityImages[`${location}-${index}`] && (
                                  <div className="mt-2">
                                    <img
                                      src={optionalActivityImages[`${location}-${index}`]}
                                      alt="Uploaded preview"
                                      className="mt-2 max-w-full h-auto rounded-lg shadow-md"
                                      style={{ maxWidth: '200px' }}
                                    />
                                    <p className="text-xs text-green-500 mt-1"> {/* Changed to green-500 */}
                                      *×”×ª××•× ×” × ×©××¨×ª ×‘××•×¤×Ÿ ××§×•××™ ×‘×“×¤×“×¤×Ÿ.
                                    </p>
                                  </div>
                                )}
                              </div>
                            </div>
                          )}
                        </div>
                      </li>
                    );
                  })}
                </ul>
              )}
            </div>
          ))}
        </div>
      </div>
    </section>
  );
};


// Currency Converter Section Component
const CurrencyConverter = () => {
  const [amount, setAmount] = useState(1);
  const [fromCurrency, setFromCurrency] = useState('ALL'); // Default to ALL
  const [toCurrency, setToCurrency] = useState('ILS');     // Default to ILS
  const [convertedAmount, setConvertedAmount] = useState(0);

  // Hardcoded rates for demonstration. In a real app, fetch from API.
  const rates = {
    ILS: {
      EUR: 1 / exchangeRates.EUR_TO_ILS, // 1 ILS to EUR
      ALL: 1 / exchangeRates.ALL_TO_ILS, // 1 ILS to ALL
      ILS: 1
    },
    EUR: {
      ILS: exchangeRates.EUR_TO_ILS,
      ALL: exchangeRates.EUR_TO_ILS / exchangeRates.ALL_TO_ILS, // EUR to ALL via ILS
      EUR: 1
    },
    ALL: {
      ILS: exchangeRates.ALL_TO_ILS,
      EUR: exchangeRates.ALL_TO_ILS / exchangeRates.EUR_TO_ILS, // ALL to EUR via ILS
      ALL: 1
    }
  };

  useEffect(() => {
    handleConvert();
  }, [amount, fromCurrency, toCurrency]); // Recalculate on input change

  const handleConvert = () => {
    const rate = rates[fromCurrency][toCurrency];
    setConvertedAmount((amount * rate).toFixed(2));
  };

  return (
    <section id="currency-converter" className="py-16 bg-gradient-to-br from-green-50 to-green-100 min-h-screen rounded-xl shadow-lg m-4"> {/* Changed to green shades */}
      <div className="container mx-auto px-4">
        <h2 className="text-5xl font-bold text-center mb-12 text-green-700 drop-shadow-md"> {/* Changed to green-700 */}
          <i className="lucide lucide-dollar-sign inline-block align-middle mr-4"></i>
          ××—×©×‘×•×Ÿ ×”××¨×ª ××˜×‘×¢
        </h2>
        <div className="bg-white p-8 rounded-2xl shadow-xl border-t-4 border-green-500 max-w-lg mx-auto"> {/* Changed to green-500 */}
          <div className="mb-6">
            <label htmlFor="amount" className="block text-lg font-medium text-gray-700 mb-2">×›××•×ª:</label>
            <input
              type="number"
              id="amount"
              value={amount}
              onChange={(e) => setAmount(parseFloat(e.target.value) || 0)}
              className="mt-1 block w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 text-lg" // Changed to green shades
            />
          </div>
          <div className="grid grid-cols-2 gap-4 mb-6">
            <div>
              <label htmlFor="fromCurrency" className="block text-lg font-medium text-gray-700 mb-2">×××˜×‘×¢:</label>
              <select
                id="fromCurrency"
                value={fromCurrency}
                onChange={(e) => setFromCurrency(e.target.value)}
                className="mt-1 block w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 text-lg" // Changed to green shades
              >
                <option value="ILS">×©×§×œ ×™×©×¨××œ×™ (ILS)</option>
                <option value="EUR">××™×¨×• (EUR)</option>
                <option value="ALL">×œ×§ ××œ×‘× ×™ (ALL)</option>
              </select>
            </div>
            <div>
              <label htmlFor="toCurrency" className="block text-lg font-medium text-gray-700 mb-2">×œ××˜×‘×¢:</label>
              <select
                id="toCurrency"
                value={toCurrency}
                onChange={(e) => setToCurrency(e.target.value)}
                className="mt-1 block w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 text-lg" // Changed to green shades
              >
                <option value="ILS">×©×§×œ ×™×©×¨××œ×™ (ILS)</option>
                <option value="EUR">××™×¨×• (EUR)</option>
                <option value="ALL">×œ×§ ××œ×‘× ×™ (ALL)</option>
              </select>
            </div>
          </div>
          <div className="text-center mt-8 p-4 bg-green-100 rounded-xl shadow-inner"> {/* Changed to green-100 */}
            <h3 className="text-2xl font-semibold text-green-800">×¡×›×•× ××•××¨:</h3> {/* Changed to green-800 */}
            <p className="text-4xl font-bold text-green-600"> {/* Changed to green-600 */}
              {convertedAmount} {toCurrency}
            </p>
          </div>
        </div>
      </div>
    </section>
  );
};

// Main App Component
function App() {
  return (
    <div className="font-inter text-right bg-gray-50" dir="rtl"> {/* Added bg-gray-50 for overall background */}
      <Navbar />
      <Hero title={tripData.title} dates={tripData.dates} />
      <Itinerary itinerary={tripData.itinerary} lodging={tripData.lodging} carRental={tripData.carRental} />
      <PackingList packingList={tripData.packingList} />
      <Budget budget={tripData.budget} />
      <GeneralOptionalActivities activities={tripData.generalOptionalActivities} />
      <CurrencyConverter />

      {/* Footer */}
      <footer className="bg-green-800 text-white text-center p-6 mt-8 rounded-t-xl"> {/* Changed to green-800 */}
        <p>&copy; 2023 ××œ×‘× ×™×” ×“×¤×¨×¡×™×”. ×›×œ ×”×–×›×•×™×•×ª ×©××•×¨×•×ª.</p>
      </footer>
    </div>
  );
}

export default App;
